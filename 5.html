<!DOCTYPE html>
<html lang="en">
<title>Гуценков Никита</title>
<Style>
    main {
        margin: 50px;
        background: #fff;
        padding-left: 15px
    }

    h1 {
        text-align: center;
    }

    form {
        display: table;
    }

    input {
        display: table-cell;
    }

    table, th, td {
        border: 1px solid black;
        margin-left: auto;
        margin-right: auto;
    }

    .p1 {
        display: table-row;
    }
</Style>
<main>
    <body style="background-color:#d3d3d3;">
    <h1>Лабораторная работа №5</h1>
    <h2>Гуценков Никита. Вариант 7</h2>
    <h2>Задание 1 (ничем не отличается от ЛР1)</h2>

    <p>В соответствии с вариантом написать JavaScript для вычисления значения функции. Ввод/вывод исходных данных
        осуществляется через диалоговые окна.</p>
    <img src="./img/10.png"><br>

    <button onclick="myFunction1()">Выполнить</button>
    <script>
        function myFunction1() {
            // введем x y z
            let x = prompt("Введите x");
            let y = prompt("Введите y");
            let z = prompt("Введите z");
            // подсчет и ответ
            let b = Math.abs(x - y) * (Math.pow(Math.sin(z), 2) + Math.tan(z));
            // вывод ответа
            alert("Ответ " + b);
        }
    </script>

    <h2>Задание 2</h2>

    <p>Переработать скрипт разработанный в задании 1 для вывода исходных данных и результатов в динамически
        сформированный HTML документ. При динамическом формировании HTML документа обязательно использовать теги.
        Результаты оформить презентабельно.</p>

    <button onclick="myFunction2()">Выполнить</button>
    <script>
        function myFunction2() {
            // введем x y z
            let x = prompt("Введите x");
            let y = prompt("Введите y");
            let z = prompt("Введите z");
            // подсчет и ответ
            let b = Math.abs(x - y) * (Math.pow(Math.sin(z), 2) + Math.tan(z));
            // вывод ответа
            document.writeln("<H2>Гуценков Никита. Вариант 7</H2>")
            document.writeln("<H3>X: " + x + "</H3>")
            document.writeln("<H3>Y: " + y + "</H3>")
            document.writeln("<H3>Z: " + z + "</H3>")
            document.writeln("<H1>Ответ: " + b + "</H1>")
        }
    </script>

    <h2>Задание 3</h2>

    <p>Разработать скрипт для проведения тестирования. Скрипт должен реализовывать следующую последовательность
        действий:
        <br>
        1.Задать вопрос о желании пройти тест (через диалоговое окно);
        <br>
        2.В случае согласия необходимо ввести следующие данные: ФИО, возраст, пол.
        <br>
        3.Циклически задать не менее 10 вопросов с 4 вариантами ответов (через диалоговое окно). Результаты ответов
        вводятся либо числом 1-4, либо буквой A-D.
        <br>
        4.По окончанию опроса сформировать HTML документ следующего содержания: заголовок – название теста, ФИО,
        возраст, пол тестируемого, результаты тестов виде таблицы заданного вида, правильные и неправильные ответы
        оформить по разному (фон, цвет, форматирование).
        <br>
        5.Так же должны быть получены ответы на следующие вопросы:
        <br>
        &nbsp;&nbsp;1.Список вопросов с правильным ответом;
        <br>
        &nbsp;&nbsp;2.Список вопросов с неверным ответом;
        <br>
        &nbsp;&nbsp;3.Вопрос, на который было затрачено более всего времени;
        <br>
        &nbsp;&nbsp;4.Среднее время ответа на вопрос;
        <br>
        &nbsp;&nbsp;5.Процент правильных ответов;
        <br>
        &nbsp;&nbsp;6.Процент неправильных ответов;
        <br>
        &nbsp;&nbsp;7.Вопросы, на которые было затрачено времени более порогового значения.</p>
    <img src="./img/11.png"><br><br>
    <form>
        <p class="p1">
            <label class="label1"> ФИО: </label>
            <input class="value" id="myname" maxlength=80 size="48" style="font-weight: bold;" type="text">
        </p>
        <p class="p1">
        <p>Пол:</p>
        <input type="radio" id="man" name="pol" value="man">
        <label for="man">Мужской</label><br>
        <input type="radio" id="wom" name="pol" value="wom">
        <label for="wom">Женский</label><br>
        </p>
        <p class="p1">
        <p>Возраст:</p>
        <select id="age"></select><br><br>
        </p>
    </form>

    <button onclick="myFunction3()">Выполнить</button>
    <script>
        // выбор возраста - генерация чисел
        function createOptions(times) {
            for (let x = 0; x <= times; x++) {
                let option = document.createElement('option');
                option.value = x;
                option.innerHTML = x;
                document.getElementById('age').appendChild(option)
            }
        }

        let _age = createOptions(100);

        /* Результаты теста. text1 - ответы, text3 - вопросы.
           Это не правильный вариант хранения данных теста,
           так как можно подсмотреть, только для демонстрации */
        results = {
            text1: [
                "1",
                "4",
                "3",
                "4",
                "1",
                "2",
                "2",
                "3",
                "4",
                "1"
            ],
            text3: [
                "Тут написан текст вопроса 1",
                "Тут написан текст вопроса 2",
                "Тут написан текст вопроса 3",
                "Тут написан текст вопроса 4",
                "Тут написан текст вопроса 5",
                "Тут написан текст вопроса 6",
                "Тут написан текст вопроса 7",
                "Тут написан текст вопроса 8",
                "Тут написан текст вопроса 9",
                "Тут написан текст вопроса 10"
            ]
        }
        // пороговое значение лимита времени (для пункта 7 отчета после теста) в секундах
        const lim = "20";

        // 1.Задать вопрос о желании пройти тест (через диалоговое окно);
        function myFunction3() {
            var retVal = confirm("Вопрос о желании пройти тест");
            if (retVal == true) {
                myFunction4();
                return true;
            } else {
                alert("ОТМЕНЕНО");
                return false;
            }
        }

        function myFunction4() {
            // 2.В случае согласия необходимо ввести следующие данные: ФИО, возраст, пол.
            let x = document.getElementById("myname").value; // фио
            let y = document.getElementById("age").value; // возраст
            let z; // пол
            if (document.getElementById('man').checked === true)
                z = "мужской";
            if (document.getElementById('wom').checked === true)
                z = "женский";
            // 3.Циклически задать не менее 10 вопросов с 4 вариантами ответов (через диалоговое окно).
            // считаем время на каждый ответ, это количество миллисекунд с 1 января 1970
            let testarr = [], timings = [], stimings = [], d, time;

            for (var i = 1; i <= 10; i++) {
                // текущее время нужно получать каждый раз перед запросом
                d = new Date();
                time = d.getTime();
                // пишем время начала демонстрации каждого вопроса
                timings[i - 1] = time;
                testarr[i - 1] = prompt("Вопрос " + i + ":\r" + results.text3[i - 1] + "\r1. Да \r2. Нет \r3. Не знаю \r4. Другое");
            }
            // пишем время ответа на последний вопрос
            d = new Date();
            time = d.getTime();
            timings[10] = time;
            // получено 11 временных меток (0-10), пересчитываем в секундах на 10 вопросов
            for (var i = 0; i < 10; i++) {
                stimings[i] = Math.round((timings[i + 1] - timings[i]) / 1000);
            }

            document.writeln("<H1>ТЕСТ</H1>");
            document.writeln("<H3>ФИО: " + x + "</H3>");
            document.writeln("<H3>Возраст: " + y + "</H3>");
            document.writeln("<H3>Пол: " + z + "</H3>");
            // генерируем таблицу, передав ответы пользователя 
            generate_table(testarr, stimings);

            // подготовим ответы на вопросы
            let a1 = [], a2 = [], a3, a4, a5, a6, a7 = [];
            // 1
            for (i = 0; i < 10; i++) {
                if (results.text1[i] === testarr[i]) {
                    a1.push(i + 1);
                }
            }
            // 2
            for (i = 0; i < 10; i++) {
                if (results.text1[i] !== testarr[i]) {
                    a2.push(i + 1);
                }
            }
            // 3
            a3 = stimings.indexOf(Math.max.apply(null, stimings)) + 1;
            // 4
            a4 = stimings.reduce((a, b) => a + b) / stimings.length;
            // 5
            a5 = (100 * a1.length) / 10;
            // 6
            a6 = (100 * a2.length) / 10;
            // 7
            for (i = 0; i < 10; i++) {
                if (stimings[i] > lim) {
                    a7.push(i + 1);
                }
            }

            document.writeln("<H3>1.Список вопросов с правильным ответом: " + a1 + "</H3>");
            document.writeln("<H3>2.Список вопросов с неверным ответом: " + a2 + "</H3>");
            document.writeln("<H3>3.Вопрос, на который было затрачено более всего времени: " + a3 + "</H3>");
            document.writeln("<H3>4.Среднее время ответа на вопрос: " + a4 + " секунд</H3>");
            document.writeln("<H3>5.Процент правильных ответов: " + a5 + "</H3>");
            document.writeln("<H3>6.Процент неправильных ответов: " + a6 + "</H3>");
            document.writeln("<H3>7.Вопросы, на которые было затрачено времени более порогового значения: " + a7 + "</H3>");
        }

        function generate_table(testarr, stimings) {
            var body = document.getElementsByTagName("body")[0];

            // создаем элементы <table> и <tbody>
            var tbl = document.createElement("table");
            var header = document.createElement('thead')
            var headingRow = document.createElement('tr')
            var headingCell = [];
            var headingText = [];
            var cellText;
            // заполняем заголовок
            headingText[1] = document.createTextNode('N')
            headingText[2] = document.createTextNode('Вопрос')
            headingText[3] = document.createTextNode('Правильный ответ')
            headingText[4] = document.createTextNode('Ответ пользователя')
            headingText[5] = document.createTextNode('Время ответа, с')

            // подготовка текста в ячейках
            for (var i = 1; i <= 5; i++) {
                headingCell[i] = document.createElement('td');
                headingCell[i].appendChild(headingText[i]);
                headingRow.appendChild(headingCell[i]);
            }
            header.appendChild(headingRow)
            tbl.appendChild(header)
            var tblBody = document.createElement("tbody");

            // создание таблицы размера 10х5
            for (var i = 0; i < 10; i++) {
                var row = document.createElement("tr");

                for (var j = 0; j < 5; j++) {
                    // Создание <td> и запись текста
                    var cell = document.createElement("td");
                    switch (j) {
                        case 0:
                            cellText = document.createTextNode(i + 1);
                            break;
                        case 1:
                            cellText = document.createTextNode(results.text3[i]);
                            break;
                        case 2:
                            cellText = document.createTextNode(results.text1[i]);
                            break;
                        case 3:
                            cellText = document.createTextNode(testarr[i]);
                            if (testarr[i] == results.text1[i])
                                cell.style.backgroundColor = "green";
                            break;
                        case 4:
                            cellText = document.createTextNode(stimings[i]);
                            break;
                    }
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                }
                tblBody.appendChild(row);
            }
            tbl.style.borderCollapse = "collapse";
            // вставка <tbody> в <table>
            tbl.appendChild(tblBody);
            // применение <table> в <body>
            body.appendChild(tbl);
            // графика таблицы
            tbl.setAttribute("border", "2");
        }
    </script>
    </body>
</main>
</html>